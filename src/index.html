<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>拜年红包</title>
    <meta name= "author" content="lzd" >
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0,user-scalable=no">
    <link rel="stylesheet" type="text/css" href="./static/css/reset.css">
    <link rel="stylesheet" type="text/css" href="./static/css/main.css?v=1554">
    <script type="text/javascript" src="./static/js/zepto.min.js"></script>
    <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?de0b584eb7d172e7749fa17ee43a6781";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
    </script>
  </head>
<body>
<script type="text/javascript">
!function(e,t){var n=e.documentElement,i="orientationchange"in window?"orientationchange":"resize",d=(/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream,function(){var t=n.clientWidth;t&&(t>=750?(t=750,e.body.style.width="750px"):e.body.style.width=t+"px",n.style.fontSize=100*(t/750)+"px",n.dataset.width=t,n.dataset.percent=100*(t/750))});d(),e.documentElement.classList.add("iosx"+t.devicePixelRatio),e.addEventListener&&t.addEventListener(i,d,!1)}(document,window)
</script>

  <div id="app">
    <div style="z-index:9999;position:absolute;left:0;top:-999rem;overflow:hidden;">
      <div id="zd_qrcode"></div>
      <canvas id="qr-canvas" width="40" height="30"></canvas>
      <input type="file" id="handleQR"  accept="image/*" />
    </div>
      <!-- 默认上传input -->
      <!-- <input id="upload" class="p-a" type="file" accept="image/*" /> -->

      <!-- loading -->
      <div class="loadingDiv">
          <div class="flex">
              <span class="wpr">
                <img src="./static/img/loading.png" class='loadingIcon' alt="">
              </span>
          </div>
      </div>

      <!-- 1 引导页 -->
      <div id="firstPage" class="p-r" style="z-index:111;display:-none">
          <div class="p-r" style="z-index:66;background-color:#d2453f;">
            <div class="tit p-a">
              <div class="t1_wpr">
                <img src="./static/img/first_t1.png" class="t1 animated" alt="">
              </div>
              <div class="t2_wpr">
                <img src="./static/img/first_t2.png" class="t2 animated" alt="">
              </div>
            </div>
            <div class="guide p-r" style="z-index:1">
                <!-- <img src="./static/img/firstPic.jpg" width="100%"> -->
            </div>
            <div class="wpr p-a" style="z-index:9">
                已有<var id="joinNum">0</var>人参加<br/>
                收到红包总额已突破<var id="targetNum">0</var>元
                <span class="chooseBtn" onclick="_hmt.push(['_trackEvent', 'wantMoneyBtn', 'click', '我要红包的点击量'])" ><img src="./static/img/chooseBtn.png" style="width:1.84rem" alt=""></span>
            </div>
          </div>
          <a onclick="_hmt.push(['_trackEvent', 'rmwSmBanner', 'click', '小banner的点击量'])" href="https://b612kaji-pstatic.snowcam.cn/static/event/vi/chunjie/renminwang/app.html" id="aside"><img src="" width="100%" style="margin-top:.1rem;transition:all .4s;-webkit-transition:all .4s;opacity:0;" alt=""></a>
      </div>

      <div class="firstPage_choose" style="display:none;">
          <div class="wpr">
            <span class="openCamera">使用咔叽拍照</span>
            <span class="openGallery">从相册选取</span>
          </div>
      </div>

      <!--  转换图片时需要 -->
      <div id="megaPixImage" style="position:absolute;z-index:8;left:0;top:-999rem;"></div>
      <!-- 生成器 -->
      <canvas id="cropCanvas" width="420" height="420" style="position:absolute;z-index:8;left:0;top:-999rem;"></canvas>

      <div id="cropSection" style="display:none;z-index:222;" >
          <!-- 选择各种主题style -->
          <div class="theme" style="z-index:2;">
            <!-- themebg -->
              <div id="theme_bg" class="p-r" style="box-sizing:border-box;">
                  <img src="" id="themeBgImg" style="width:100%;">
                  <img id="eCode" class="ecode p-a" src="./static/img/upqr.jpg" alt="">
              </div>
               <!-- themehead -->
              <div id="cropLayer" class="p-a" style="z-index:266">
                  <!-- <img src="" class="themeHead" data-width="0" alt=""> -->
                  <div class="wpr p-a" style="">
                      <img id="cropImg" class="p-a" style="top:0;width:100%" src="">
                  </div>
              </div>
              <div id="dropArea" class="defaultPic p-a"></div>
          </div>

          <a href="javascript:void(0)" id="toNext" style="position:absolute;left:0;top:-999rem;">下一步</a>
          <div class="styleChoose p-r" id="theme_foot">
            <img src="" alt="">
              <!-- <a href="javascript:void(0)" id="reChoose">重新选择</a> -->
              <div class="wpr p-a">
                <div class="">
                    <div class="item" id="reChoose"><img src="./static/img/reChoose.png" style="width:.63rem;" alt=""> </div>
                    <span>
                      <!-- <div class="item"></div><div class="item"></div><div class="item"></div><div class="item"></div><div class="item"></div> -->
                    </span>
                </div>
              </div>
          </div>

      </div>

      <!-- 生成canvas - 图片 -->
      <div id="proSection" style="display:none;">
        <div class="p-r">
            <div class="view">
              <div class="vwpr">
                <img src="" alt="">
              </div>
            </div>
            <div class="content p-r">
                <img src="" width="100%" alt="">
                <div class="wpr p-a">
                  <div><span class="save">保存</span></div>
                  <div><span class="share">分享</span></div>
                </div>
            </div>
          </div>
      </div>

      <div class="toast" style="display:none">拜年红包图制作完成</div>

      <!-- 文本提示 -->
      <div class="nextGuide" style="display:none">
        <div class="wpr p-r">
          <div class="paw p-a"><img src="./static/img/paw.png" alt=""></div>
          <div class="paw2 p-a"><img src="./static/img/paw.png" alt=""></div>
          <div class="flow p-a"><img src="./static/img/flower.png" alt=""></div>
          <div class="p1">
            <!-- 保存好了~<br/>分享给亲朋好友领红包吧 -->
          </div>
          <div class="confirm">
            <span>确定</span>
          </div>
        </div>
      </div>

      <div id="qrGuide" style="z-index:333;display:none;">
          <div class="wpr">
            <div class="return">
              返回
            </div>
            <a href="javascript:void(0)" class="btn">上传微信收款二维码</a>
            <img src="" style="width:6.87rem" alt="">
            <p>
              - 1 -<br/>
              点击微信右上角“+”，弹出框点击“收付款”
            </p>
            <img src="" style="width:4.32rem" alt="">
            <p>
              - 2 -<br/>
              点击“二维码收款”
            </p>
            <img src="" style="width:4.65rem" alt="">
            <p>
              - 3 -<br/>
              点击“保存收款码”
            </p>
            <img src="" style="width:4rem" alt="">
            <p>
              - 4 -<br/>
              收款码将会保存在相册里
            </p>
            <img src="" style="width:4.26rem" alt="">

            <a href="javascript:void(0)" class="btn">上传微信收款二维码</a>
          </div>
      </div>

  </div>
  <!-- mp3 -->
  <audio src="" controls loop id='audio'  style="position:absolute;top:0;top:-999rem;"></audio>
  <div id="audio_control" class='p-a'>
    <img src="./static/img/audio_Icon.png" alt="">
  </div>

<div id="testTxt" style="display:none;position:fixed;white-space:nowrap;overflow:scroll;line-height:1;width:100%;z-index:11166666;bottom:0;left:0;">test</div>
<img id="testImg" src="" style="position:absolute;z-index:666;top:-999rem;left:0;" alt="">
<script>
window.getCameraS = false;
function loadScript(_src,cb){
    var script = document.createElement('script');
    script.type="text/javascript";
    if(script.readyState){
        script.onreadystatechange = function(){
            if(script.readyState == 'loaded' || script.readyState == 'complete'){
                script.onreadystatechange = null;cb && cb();
            }
        }
    } else {
        script.onload = function(){cb && cb()};
    }
    script.src=_src;document.getElementsByTagName('head')[0].appendChild(script);
}

!function(){
  var params = document.location.search.substr(1).split('&'),
      URLParams = {};
  for (i=0; i < params.length ; i++){
      var aParam = params[i].split('=');
      URLParams[aParam[0]] = aParam[1];
  }
  var _from=URLParams["from"];
  window.getCameraS = !!_from;

  var ua=navigator.userAgent;
  window.isAndroid=false;
  window.isIos = false;
  window.isOther = false;
  if(/Android (\d+\.\d+)/.test(ua)){
    window.isAndroid=true;
    loadScript('./static/js/bridge_android.js');
  }else if(/iPhone|iPad|iPod/i.test(ua)){
    window.isIos = true;
    loadScript('./static/js/bridge_ios.js');
  }else{
    window.isOther = true;
  }

}()

  var zeptoJsLoaded = true,
      extJsLoad = false,
      globalJsloaded = false,
      mainJsLoaded = false,
      allJsloaded = false;
  var checkAll = function(val){
          console.log("check js this time ok:",val,zeptoJsLoaded , extJsLoad , globalJsloaded , mainJsLoaded);
          if(zeptoJsLoaded && extJsLoad && globalJsloaded && mainJsLoaded){
            // console.log('ok 23333');
              setTimeout(function(){
                indexPageReady();
              },0)
              allJsloaded = true;
              checkAll = null;
          }else{return;}
      };
      loadScript('./static/js/global.js',function(){
          globalJsloaded = true;
          checkAll('global');
      })
      loadScript('./static/js/ext.js',function(){
          extJsLoad = true;
          checkAll('ext');
      })
      loadScript('./static/js/main.js?v=261356',function(){
          mainJsLoaded = true;
          checkAll('main');

      })

</script>
</body>
<script>
!function(){
  var auBtn = document.querySelector('#audio_control'),
      myappd = document.querySelector('#app'),
      audio_ = document.querySelector('#audio'),
      icon = document.querySelectorAll('#audio_control img')[0],
      image = auBtn.querySelector('img'),
      touchp = ("createTouch" in document)?"touchend":"click",
      zTop = $("#cropSection").scrollTop(),
      isPlaying = false;
      audio_.src="./mus.mp3";
      audio_.load();

      var _pause = function() {
        isPlaying = false;
        auBtn.classList.remove('run');
        icon.style.animationName="";
        icon.style.WebkitAnimationName="";
        icon.style.animationPlayState="paused";
        icon.style.WebkitAnimationPlayState="paused";
        audio_.pause()
      }
      var _play = function() {
        isPlaying = true;
        auBtn.classList.add('run');
        icon.style.animationName="audIconRun";
        icon.style.WebkitAnimationName="audIconRun";
        icon.style.animationPlayState="running";
        icon.style.WebkitAnimationPlayState="running";
        audio_.play()

      }
      function musicHandler(ev) {
          _play()
          document.body.removeEventListener(touchp, musicHandler);
          ev.stopPropagation();
      }
      document.body.addEventListener(touchp, musicHandler,false);

    document.querySelector('#audio_control').addEventListener(touchp, function(ev) {
      isPlaying?_pause():_play();
      ev.stopPropagation();
    },false);


    if(!!document.visibilityState){
      document.addEventListener("visibilitychange", function () {
        var status = isPlaying;
        setTimeout(function(){
          if(document.visibilityState == 'hidden'){
              audio_.pause()
          }else if(document.visibilityState == 'visible'){
              status?_play():_pause();
          }
        },120)
      }, false);
    }
    _play()
}()

$('#testTxt').show().text('261356' + window.getCameraS);
!(window.getCameraS) && loadScript('./static/js/count.js',function(){
  var s1 = '2018/01/25',
      s2 = Date.now(),//当前日期：2017-04-24
      mcs = s2 - new Date(s1).getTime(),
      targNum = 0,
      time = Math.floor(mcs / (1000 * 60 * 60 * 24)),
      _days = Math.floor(mcs / (1000 * 60 * 60 * 24)),
      _hours = Math.floor(mcs / (1000 * 60 * 60)) - (_days*24),
      _mins = Math.floor(mcs / (1000 * 60)) - (_days*24*60) - _hours*60,
      _secs = Math.floor(mcs / (1000)) - (_days*24*3600) - _hours*3600 - _mins *60;

    if(_days < 2){
      targNum = parseInt(_days*24*3600*80 + (_hours*3600*80) + (_mins*60*80) + (_secs*80))
    }else if(_days >= 2 && _days < 4){
      targNum = parseInt(2*24*3600*80 + (1*24*3600*50) + (_hours*3600*50) + (_mins*60*50) + (_secs*50))
    }else if( _days >=4 && _days < 6){
      targNum = parseInt(2*24*3600*80 + (2*24*3600*50) + (_hours*3600*30) + (_mins*60*30) + (_secs*30))
    }else if( _days >=6 && _days < 8){
      targNum = parseInt(2*24*3600*80 + (2*24*3600*50) + (2*24*3600*30) + (_hours*3600*20) + (_mins*60*20) + (_secs*20))
    }else{
      targNum = parseInt(2*24*3600*80 + (2*24*3600*50) + (2*24*3600*30) + (2*24*3600*20) + (_hours*3600*5) + (_mins*60*5) + (_secs*5))
    }

  document.querySelectorAll('.loadingDiv')[0].style.display='';
  // 默认图片
  var img = new Image();
  img.onload = function(){
    img.setAttribute('width','100%')
    document.querySelectorAll('.guide')[0].appendChild(img);
    defaultbgStatue = true;
  }
  img.src = './static/img/firstPic.jpg';
  // number  开始运行
  var joinNum = targNum,
      targetNum = parseInt(joinNum*32),
      count = new CountUp('targetNum', 0, targetNum, 0, 1.5),
      join = new CountUp('joinNum', 0, joinNum, 0, 1),
      f_t1 = document.querySelector('#firstPage .t1'),
      f_t2 = document.querySelector('#firstPage .t2');

  var timer = setInterval(function(){
    if(defaultbgStatue){
      clearInterval(timer);
      timer = null;
      if(loadingStop)loadingStop();

      if(!document.querySelector('#app').classList.contains('full')){
        var img = new Image();
        img.onload = function(){
          $('#aside img')[0].src=this.src;
          $('#aside img')[0].style.opacity=1;
        }
        img.src="./static/img/aside.jpg";
      }

      // 首屏 标题
      f_t1.classList.add('bounceInDown');
      f_t2.classList.add('fadeIn');
      join.start()
      count.start(function(){
        join = count = null;
      });
    }
  },0)
})
</script>
</html>
